<?php

namespace Yomaah\structureBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * PageRepo
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class PageRepo extends EntityRepository
{
    public function findKeywords($pageUrl, $site = null)
    {
        if ($site == null)
        {
            /*
             * A remplacer par 
$query = $this->getEntityManager()
    ->createQuery('select a, p from yomaahBundle:Article a join a.page p where p.pageUrl = :url order by a.artId asc')
    ->setParameter('url',$pageUrl);
             */
            $query = $this->getEntityManager()
                ->createQuery('select p.keywords from yomaahBundle:Page p where p.pageUrl = :url')
                ->setParameter('url',$pageUrl);
        }else
        {
            $query = $this->getEntityManager()
                ->createQuery('select p.keywords from yomaahBundle:Page p join p.site s where p.pageUrl = :url and s.idSite = :site')
                ->setParameters(array('url' => $pageUrl,'site' => $site));
        }
        $keywords = $query->getSingleResult();
        if (strlen($keywords['keywords']) == 0)
        {
            return array('keywords' => false);
        }else
        {
            return $keywords;
        }
    }
    public function getHtml()
    {
        return '<div class="page admin-c border">
                    <input type="hidden" name="id" value="%pageId%" />
                    <section class="contentPage">
                        <article class="adminPage art-titre">
                            <h1>Page : %position%</h1>
                            <label>Position</label><input type="text" name="position" value="%position%" />
                            <label>Mot-clés</label><textarea class="textareaPage" name="keywords">%keywords%</textarea>
                        </article>
                    </section>
                    <article class="btn-admin maj">
                        <li>Mettre à jour</li>
                    </article>
                   </div>';
    }
 
}
